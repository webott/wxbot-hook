   注：该偏移计算公式并不准确，因为对于其他转移指令而言，其指令长度未必就是5字节。在计算短转移或近转移时，如果按照5字节进行计算就会出错，因此准确的描述应该是“jmp后的偏移量＝目标地址－原地址－jcc的指令长度”。最后减去的指令长度应该根据具体的情况而定。在Inline Hook中，由于确定jmp 指令的长度为5字节，因此在这里是可行的。

上面地址都是用十六进制进行计算的，读者计算时要注意这一点，以免计算错误。通过上面的例子可以看出，修改时只需要修改5字节就可以了。下面来梳理 Inline Hook的流程，具体如下。
①构造跳转指令。②在内存中找到欲HOOK函数地址，并保存欲HOOK位置处的前5字节。③将构造的跳转指令写入需HOOK的位置处。④当被HOOK位置被执行时会转到自己的流程执行。⑤如果要执行原来的流程，那么取消HOOK,也就是还原被修改的字节。⑥执行原来的流程。⑦继续HOOK住原来的位置。这就是 Inline Hook的大概流程。由于Inline Hook的实现代码比较简单，关键就是一个HOOK和一个取消HOOK的过程，因此可用C++封装一个Inline Hook的类。在今后Inline Hook编程中，可以始终使用这个封装好的类。
一般情况下，封装类都有两个文件，一个是类的头文件，另一个是类的实现文件。在
Windows 下使用MFC进行开发类名（Class Name)都习惯以“C”开头，这里封装的是InlineHook类，因此类名是CILHook.为了保持一致性，类的头文件和实现文件分别是ILHook.h文件和ILHook.cpp文件。先来看一下ILHook.h文件中的类定义部分。＃ifndef ILHOOK_H_F47BF581_8D85_49ef_923D_895DCC9E4471.＃define_ILHOOK_H_F47BF581_8D85_49ef_923D_895DCC9E4471
＃include <Windows.h>

在C++中，下，把成员函数放在上面，把成员变量放在下面。因为对于拿到头文件的使用人员来说，他首先关注的是类实现了哪些功能，因此应该让他第一眼就能看到实现了的成员函数。当然，这不是必需的，只是一种习惯。回到类定义，在类中除了构造函数和析构函数以外，还定义了3个成员函数，分别是HookO、UnHook(和ReHook().它们的功能分别是用来进行HOOK 操作、取消HOOK 操作和重新进行HOOK操作。对于3个成员函数来说，这里只是一个定义，实现部分在ILHook.cpp中。除了上面的3个成员函数外，还定义了3个成员变量，分别是m_pfnOrig、m_bOldBytes[5]和m_bNewBytes[5].这3个函数的作用已经在定义中给出了注释，想必读者应该能明白，这里就不具体说了。接着看ILHook.cpp文件中的实现代码，具体如下：类的定义使用关键字“class”。在类中定义有成员函数和成员变量，通常情况

该函数是InlineHook类的重要函数。在HookO成员函数中完成了3项工作，首先是获得了被HOOK函数的函数地址，接下来是保存了被HOOK函数的前5字节，最后是用构造好的跳转指令来修改被HOOK函数的前5字节的内容。除了上面的函数外，还有两个函数，分别是取消挂钩和重新挂钩。这两个函数非常简单，就是完成复制字节的工作。代码如下：

上面两个成员函数就不进行介绍了，只要读者能看懂Hook(函数的实现，就肯定能理解这两个函数的功能。整个Inline Hook的封装已经完成了，在后面的代码中，可以很容易地实现对函数的HOOK 功能。

个人微信
目前已经实现了很多有趣的功能，运行稳定，比如：发各种消息，
接收各种消息，群管，下载文件，加好友，检测僵尸粉，朋友圈等等功能，
可提供接口，方便各种语言二次开发，欢迎技术交流，Q：2645542961
，请勿用于商业用途。

![image](https://user-images.githubusercontent.com/73727649/193174651-f4b8e554-bba1-4043-84e7-7edbe04c5eff.png)


企业微信：
目前已经实现了大部分功能，运行稳定，比如：发各种消息，
接收各种消息，外部群内部群管理，下载文件，加好友等等功能，
可提供接口，方便各种语言二次开发，欢迎技术交流。


